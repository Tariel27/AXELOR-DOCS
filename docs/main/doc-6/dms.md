Эти услуги обеспечивают базовый доступ к различным функциям DMS.

[](#file-listing)Список файлов
------------------------------

Этот сервис можно использовать для поиска списка файлов в определенном каталоге.

Веб-сервис доступен по следующему шаблону URL:

ПОЛУЧИТЬ /ws/dms/files?parent=id&pattern=matching

Запрос

ПОЛУЧИТЬ /ws/dms/files
Принять: приложение/json

Запрос

ПОЛУЧИТЬ /ws/dms/files?parent=2
Принять: приложение/json

Запрос

ПОЛУЧИТЬ /ws/dms/files?parent=2&pattern=some
Принять: приложение/json

Запрос также принимает параметры запроса:

*   `parent`\- идентификатор родительского каталога

*   `pattern`\- шаблон соответствия имени файла


Оба параметра являются необязательными и в этом случае указывают корневой каталог.

Ответ:

    {
      "total": 2,
      "data": [{
        "id": 1,
        "version": 1,
        "fileName": "some.pdf",
        "isDirectory": false
      }, {
        "id": 2,
        "version": 0,
        "fileName": "Some Folder",
        "isDirectory": true
      }]
    }

JSON![копировать значок](../../../../_/img/octicons-16.svg#view-clippy)Скопировано!

Данные ответа представляют собой `DMSFile`записи.

[](#file-download)Загрузка файла
--------------------------------

Этот сервис можно использовать для загрузки файла. Его следует использовать как обычный http-запрос.

ПОЛУЧИТЬ /ws/dms/download/:id

Это `id`должен быть `DMSFile`идентификатор записи.

Запрос

ПОЛУЧИТЬ /ws/dms/download/1

Ответ:

    Content-Disposition -> attachment; filename="some.pdf"
    Content-Length -> 7296
    Content-Transfer-Encoding -> binary
    Content-Type -> application/octet-stream

![копировать значок](../../../../_/img/octicons-16.svg#view-clippy)Скопировано!

[](#file-upload)Файл загружен
-----------------------------

Служба загрузки не включает файл в DMS напрямую, а создает `MetaFile` записи, указывающие на загруженный файл. Запись `MetaFile`можно использовать позже для создания `DMSFile`записи (обычной или вложенной).

Сервис загрузки позволяет загружать файлы частями. Это полезно для эффективной загрузки больших файлов.

Запрос

POST/ws/files/upload
Длина содержимого: 148009
Тип контента: приложение/октет-поток
Имя X-файла:some.tar.gz
Смещение X-файла:0
Размер X-файла: 148009
Тип X-файла: application/gzip

Тело запроса должно представлять собой фрагмент данных файла. Заголовки `Content-Length`и следует использовать для предоставления подробной информации о фрагменте `X-File-Offset`, `X-File-Size`чтобы:

Смещение X-файла + Длина содержимого <= Размер X-файла

Заголовки:

*   `X-File-Id`\- идентификатор файла, возвращаемый первым запросом на загрузку фрагмента

*   `X-File-Name`\- имя загружаемого файла

*   `X-File-Offset`\- смещение чанка

*   `X-File-Size`\- реальный размер файла

*   `X-File-Type`\- тип mime файла


При загрузке частями первый запрос на загрузку со смещением `0`возвращает уникальный идентификатор файла. Этот идентификатор файла следует передавать в качестве `X-File-Id`заголовка при последующих загрузках фрагментов оставшегося контента.

Последний запрос на загрузку возвращает следующий ответ:

Ответ

    {
      "id": 1,
      "fileName": "some.tar.gz",
      "filePath": "some.tar.gz",
      ...
    }

JSON![копировать значок](../../../../_/img/octicons-16.svg#view-clippy)Скопировано!

Запись ответа представляет собой `MetaFile`запись.

[](#list-attachments)Список вложений
------------------------------------

Этот сервис можно использовать для поиска списка файлов, прикрепленных к определенной записи.

Веб-сервис доступен по следующему шаблону URL:

ПОЛУЧИТЬ /ws/dms/attachments/:модель/:id

Запрос

ПОЛУЧИТЕ /ws/dms/attachments/com.axelor.sale.db.Order/1
Принять: приложение/json

Ответ:

    {
      "total": 2,
      "data": [{
        "id": 1,
        "version": 1,
        "fileName": "some.pdf"
      }, {
        "id": 2,
        "version": 0,
        "fileName": "another.pdf"
      }]
    }

JSON![копировать значок](../../../../_/img/octicons-16.svg#view-clippy)Скопировано!

Данные ответа представляют собой `DMSFile`записи.

[](#add-attachment)Добавить приложение
--------------------------------------

Запись `MetaFile`, полученную с помощью службы загрузки, можно использовать для создания вложений.

Запрос

ПОМЕСТИТЕ /ws/dms/attachments/com.axelor.sale.db.Order/1
Принять: приложение/json
Тип контента: приложение/json

    {
      "records": [{
          "id": 1
      }]
    }

JSON![копировать значок](../../../../_/img/octicons-16.svg#view-clippy)Скопировано!

Массив записей представляет собой `MetaFile`записи (полученные с помощью [службы загрузки](#file-upload) ).

Ресурс

    {
      "data": [{
          "id": 101,
          "fileName": "some.tar.gz"
      }]
    }

JSON![копировать значок](../../../../_/img/octicons-16.svg#view-clippy)Скопировано!

Данные ответа представляют собой `DMSFile`записи.

[](#delete-attachment)Удалить вложение
--------------------------------------

Просто выполните [запрос](rest.html#delete-a-record) на удаление, `com.axelor.dms.db.DMSFile`чтобы удалить вложение, представленное файлом.